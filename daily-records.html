<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>السجلات اليومية</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            text-align: right;
            margin: 9px;
        }
        h1 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #333;
            color: #fff;
        }
        .actions {
            margin-top: 10px;
        }
        .actions a {
            display: inline-block;
            margin: 10px;
            padding: 10px 20px;
            text-decoration: none;
            color: #fff;
            background-color: #007bff;
            border-radius: 4px;
        }
        .actions a:hover {
            background-color: #0056b3;
        }
        .date-buttons {
            margin-bottom: 20px;
        }
        .date-buttons button {
            margin-right: 10px;
            margin-bottom: 10px;
            padding: 10px 20px;
            background-color: #28a745;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .date-buttons button:hover {
            background-color: #218838;
        }
        .search-container {
            margin-bottom: 20px;
        }
        .search-container input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 200px;
            margin-right: 10px;
        }
        .search-container button {
            padding: 10px 20px;
            margin-top: 10px;
            background-color: #ffc107;
            color: #000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>السجلات اليومية</h1>

    <div class="search-container">
       
        <input type="text" id="search-name" placeholder="أدخل اسم العميل">
        <button onclick="searchByName()">بحث بالاسم</button>
    </div>
    <div class="actions">
        <a href="customers.html">العملاء</a>
        <a href="suppliers.html">الموردين</a>
        <a href="sales.html">البيع</a>
    </div>
    <div class="date-buttons" id="date-buttons"></div>

    <table>
        <thead>
            <tr>
                <th>اسم العميل</th>
                <th>عدد الفواتير</th>
                <th>الإجمالي</th>
                <th>تفاصيل الفواتير</th>
            </tr>
        </thead>
        <tbody id="invoice-table-body"></tbody>
    </table>

   

    <script>
        const invoices = JSON.parse(localStorage.getItem('invoices')) || [];
        const dateButtonsContainer = document.getElementById('date-buttons');
        const invoiceTableBody = document.getElementById('invoice-table-body');

        function groupInvoicesByName() {
            const grouped = {};

            invoices.forEach(invoice => {
                if (!grouped[invoice.customerName]) {
                    grouped[invoice.customerName] = { total: 0, invoices: [] };
                }
                grouped[invoice.customerName].total += invoice.total;
                grouped[invoice.customerName].invoices.push(invoice);
            });

            return grouped;
        }

        function displayGroupedInvoices() {
            const groupedInvoices = groupInvoicesByName();
            invoiceTableBody.innerHTML = '';

            Object.keys(groupedInvoices).forEach(customerName => {
                const { total, invoices } = groupedInvoices[customerName];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customerName}</td>
                    <td>${invoices.length}</td>
                    <td>${total.toFixed(2)}</td>
                    <td><button onclick="showGroupedInvoiceDetails('${customerName}')">عرض التفاصيل</button></td>
                `;
                invoiceTableBody.appendChild(row);
            });
        }

        function showGroupedInvoiceDetails(customerName) {
            const groupedInvoices = groupInvoicesByName();
            const customerData = groupedInvoices[customerName];
            if (customerData) {
                let details = `اسم العميل: ${customerName}\n\n`;
                customerData.invoices.forEach(invoice => {
                    details += `التاريخ: ${invoice.date}\n`;
                    invoice.items.forEach(item => {
                        details += `${item.productName} - ${item.quantity} x ${item.price.toFixed(2)} = ${item.total.toFixed(2)}\n`;
                    });
                    details += `\n`;
                });
                details += `الإجمالي الكلي: ${customerData.total.toFixed(2)}`;
                alert(details);
            }
        }

        displayGroupedInvoices();
    </script>
    <script>
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }
    
        function searchByName() {
            const searchName = document.getElementById('search-name').value.trim();
            invoiceTableBody.innerHTML = '';
    
            const filteredInvoices = invoices.filter(invoice => 
                invoice.customerName.toLowerCase().includes(searchName.toLowerCase())
            );
    
            filteredInvoices.forEach(invoice => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${invoice.customerName}</td>
                    <td>${invoice.date}</td>
                    <td>${invoice.total.toFixed(2)}</td>
                    <td><button onclick="showInvoiceDetails('${invoice.customerName}', '${invoice.date}')">عرض التفاصيل</button></td>
                `;
                invoiceTableBody.appendChild(row);
            });
        }
    
        function initializeSearch() {
            const nameParam = getQueryParam('name');
            if (nameParam) {
                document.getElementById('search-name').value = nameParam;
                searchByName();
            }
        }
    
        // استدعاء الوظيفة عند تحميل الصفحة
        initializeSearch();
    </script>
    
</body>
</html>
